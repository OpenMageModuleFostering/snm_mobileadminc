(function(c,t,o){function j(a,b){this.START_OFFSET=8;this.MAX_DISTANCE=250;this.THREASHOLD_RATIO=0.5;this.element=a;this.options=b;this.currentRatio=this.flippingSide=null;this.isInAnimation=!1}function l(a,b){this.element=a;this.options=b;this.currentRatio=this.slideSide=null;this.START_OFFSET=8;this.MAX_DISTANCE=400;this.isInAnimation=!1}function h(a,b){this.element=a;this.options=c.extend({},q,b);this._defaults=q;this._name=n;this.jqmInit();this._clickContext={downPt:null,downTime:null,flipside:null,
dList:[],tList:[]};this.options.didEndFlip=this._getCleanupFunc();this.effect="flip"==this.options.effect&&this.isFlipSupported()?new j(this.element,this.options):new l(this.element,this.options);this.init()}var n="flip",q={effect:"flip",forwardDir:"rtol",height:"",keyboardNav:!0,showPager:!1,loop:!1},r="flip-",s=[{key:"effect",attr:"effect",type:0},{key:"forwardDir",attr:"forward-dir",type:0},{key:"height",attr:"height",type:0},{key:"keyboardNav",attr:"keyboard-nav",type:1},{key:"showPager",attr:"show-pager",
type:1},{key:"loop",attr:"loop",type:1}],p="";j.prototype._initShadow=function(){var a=c(this.element).children(".flipCurrent"),b=a.width(),a=a.height(),d=c('<div class="flipShadow"></div>').hide();d.css("position","absolute").css("background-color","#111111").css("opacity","0.9").css("display","none");this._isVertical()?d.css("width",b+"px").css("height",a/2+"px").css("top",a/2+"px").css("left","0"):d.css("width",b/2+"px").css("height",a+"px").css("left",b/2+"px").css("top","0");return d};j.prototype._isVertical=
function(){return"ttob"==this.options.forwardDir||"btot"==this.options.forwardDir?!0:!1};j.prototype._splitElem=function(a,b){var d=c(this.element);if(null==a||0==a.length){var f=d.width(),e=d.height();if(this.options.showPager)var g=d.children(".pager"),e=e-g.height();a=c('<div class="splitEmpty" style="width: '+f+"px; height: "+e+'px;"></div>')}var f=this._isVertical(),e=b+"First",g=b+"Second",i=d.children(e);0==i.length?i=c('<div class="splitHalf firstHalf '+e+'"></div>'):i.empty();var k=d.children(g);
0==k.length?k=c('<div class="splitHalf secondHalf '+g+'"></div>'):k.empty();i.append(a.clone());k.append(a.clone());i.find("a").each(function(a,b){c(b).bind("click",function(){return!1})});k.find("a").each(function(a,b){c(b).bind("click",function(){return!1})});var h=a.width(),m=a.height();f?(i.css("width",h+"px").css("height",m/2+"px"),i.children(":first").css("height",m+"px").css("display","block")):(i.css("width",h/2+"px").css("height",m+"px"),i.children(":first").css("width",h+"px").css("display",
"block"));f?(k.css("width",h+"px").css("height",m/2+"px").css("top",m/2+"px"),k.children(":first").css("height",m+"px").css("display","block").css("top",-1*m/2+"px")):(k.css("width",h/2+"px").css("height",m+"px").css("left",h/2+"px"),k.children(":first").css("width",h+"px").css("display","block").css("left",-1*h/2+"px"));0==d.children(e).length&&d.append(i);0==d.children(g).length&&d.append(k);return{first:i,second:k}};j.prototype.init=function(a){if(null==this.currentRatio){this.currentRatio=0;this.flippingSide=
a;var b=c(this.element),d=b.children(".flipCurrent"),f=null,e=f=null,f="ltor"==this.options.forwardDir&&1==a||"rtol"==this.options.forwardDir&&-1==a||"ttob"==this.options.forwardDir&&1==a||"btot"==this.options.forwardDir&&-1==a?this.getNextContent(d):this.getPrevContent(d),e=this._splitElem(f,"back"),d=this._splitElem(d,"front");-1==a?(f=d.second,e=e.first):(f=d.first,e=e.second);f.css("zIndex",1);var g=this._initShadow();this._isVertical()?(f.addClass("verticalFlipping"),e.addClass("verticalFlipping"),
1==a&&g.css("top","0px")):(f.addClass("holizontalFlipping"),e.addClass("holizontalFlipping"),1==a&&g.css("left","0px"));b.append(g);f.addClass("flipping");e.addClass("backflipping");d=b.children(".flipCurrent");d.removeClass("flipCurrent");d.addClass("working");g.show()}};j.prototype.step=function(a){if(0!=c(this.element).children(".working").length){this.currentRatio=a;var b=p+"Transform";this._isVertical()?1==this.flippingSide?(c(".flipping").css(b,"rotateX("+-180*a+"deg)"),c(".backflipping").css(b,
"rotateX("+-1*(180+180*a)+"deg)")):(c(".flipping").css(b,"rotateX("+-180*a+"deg)"),c(".backflipping").css(b,"rotateX("+(180-180*a)+"deg)")):1==this.flippingSide?(c(".flipping").css(b,"rotateY("+180*a+"deg)"),c(".backflipping").css(b,"rotateY("+(180+180*a)+"deg)")):(c(".flipping").css(b,"rotateY("+180*a+"deg)"),c(".backflipping").css(b,"rotateY("+-1*(180-180*a)+"deg)"));b=c(this.element).children(".flipping").height();a=Math.abs(180*a);90<a?(c(".flipping").css("zIndex","0"),this._isVertical()?-1==
this.flippingSide?c(".flipShadow").css("top","0"):c(".flipShadow").css("top",b+"px"):-1==this.flippingSide?c(".flipShadow").css("left","0"):c(".flipShadow").css("left","50%"),a=Math.max(0,1-(-1.2*((180-a)/90-1)*((180-a)/90-1)+1.2))):(c(".flipping").css("zIndex","1"),this._isVertical()?-1==this.flippingSide?c(".flipShadow").css("top",b+"px"):c(".flipShadow").css("top","0"):-1==this.flippingSide?c(".flipShadow").css("left","50%"):c(".flipShadow").css("left","0"),a=Math.max(0,1-(-1.2*(a/90-1)*(a/90-
1)+1.2)));c(".flipShadow").css("opacity",0.9*a)}};j.prototype.action=function(a){var b=this.currentRatio,d=this,c=0,e=Math.abs(this.currentRatio),g=Math.abs(a-this.currentRatio),i=1;0>this.currentRatio?i=-1:0==this.currentRatio&&0>a&&(i=-1);var h=function(a){a=Math.abs(a)/g;a-=1;return g*(a*a*a+1)+e};0==a&&(e=0);var j=function(){c=Math.min(1,c+0.05);var e=Math.min(1,h(c));0==a&&(e=Math.abs(b)-e);0>i&&(e*=-1);d.step(e);c+0.05<g?setTimeout(j,20):(d.currentRatio=a,d.cleanup())};this.isInAnimation=!0;
j()};j.prototype.cleanup=function(){var a=c(this.element).children(".working");c(".flipShadow").replaceWith("");c(".firstHalf").replaceWith("");c(".secondHalf").replaceWith("");var b=a;"ltor"==this.options.forwardDir&&1==this.flippingSide||"rtol"==this.options.forwardDir&&-1==this.flippingSide||"ttob"==this.options.forwardDir&&1==this.flippingSide||"btot"==this.options.forwardDir&&-1==this.flippingSide?1==Math.abs(this.currentRatio)&&(b=this.getNextContent(a)):1==Math.abs(this.currentRatio)&&(b=this.getPrevContent(a));
b.addClass("flipCurrent");a.removeClass("working");"function"==typeof this.options.didEndFlip&&this.options.didEndFlip();this.flippingSide=this.currentRatio=null;this.isInAnimation=!1};j.prototype.getNextContent=function(a){a=a.next(".flipContent");0==a.length&&this.options.loop&&(a=c(this.element).children(".flipContent").first());return 0==a.length?c():a};j.prototype.getPrevContent=function(a){a=a.prev(".flipContent");0==a.length&&this.options.loop&&(a=c(this.element).children(".flipContent").last());
return 0==a.length?c():a};j.prototype.shouldTransitionContinue=function(a,b){var c=1,f=1,e=0,g=0;2<=b.tList.length?(c=b.tList[b.tList.length-1],f=b.tList[b.tList.length-2],e=b.dList[b.dList.length-1],g=b.dList[b.dList.length-2]):1==b.tList.length&&(c=b.tList[b.tList.length-1],e=b.dList[b.dList.length-1]);var i=((new Date).getTime()-b.lastInfo.time)/100,a=a+(1>i?1:1/(10*i*i))*(e/c+g/f),a=1==this.flippingSide?Math.max(0,Math.min(1,a)):Math.max(-1,Math.min(0,a));return Math.abs(a)>this.THREASHOLD_RATIO};
l.prototype.init=function(a){if(null==this.currentRatio){this.MAX_DISTANCE="rtol"==this.options.forwardDir||"ltor"==this.options.forwardDir?c(this.element).width():c(this.element).height();this.THREASHOLD_RATIO=Math.min(0.15,100/this.MAX_DISTANCE);this.currentRatio=0;this.slideSide=a;var b=c(this.element),d=b.children(".flipCurrent"),f=null,e=!1;"ltor"==this.options.forwardDir&&1==a||"rtol"==this.options.forwardDir&&-1==a||"ttob"==this.options.forwardDir&&1==a||"btot"==this.options.forwardDir&&-1==
a?(f=this.getNextContent(d),e=!0):f=this.getPrevContent(d);null==f&&(f=c());a=c(".slidingBg");0==a.length?a=c('<div class="slidingBg"></div>'):a.empty();a.hide();e?b.append(a.append(f.clone())):b.append(a.append(d.clone()));a.css("width",d.width()+"px");a.css("height",d.height()+"px");a.children(":first").css("display","block");var g=c(".sliding");0==g.length?g=c('<div class="sliding"></div>'):g.empty();e?b.append(g.append(d.clone())):b.append(g.append(f.clone()));g.css("width",d.width()+"px").css("height",
d.height()+"px").css("zIndex",1);if(!e)switch(this.options.forwardDir){case "rtol":g.css("left",-1*this.MAX_DISTANCE+"px");break;case "ltor":g.css("left",this.MAX_DISTANCE+"px");break;case "ttob":g.css("top",this.MAX_DISTANCE+"px");break;case "btot":g.css("top",-1*this.MAX_DISTANCE+"px")}g.children(":first").css("display","block");d=b.children(".flipCurrent");d.removeClass("flipCurrent");d.addClass("working");a.show()}};l.prototype.step=function(a){this.currentRatio=a;var a=this.MAX_DISTANCE*a,b=
c(this.element),d=b.children(".sliding");b.height();switch(this.options.forwardDir){case "ltor":1==this.slideSide?d.css("left",a+"px"):d.css("left",this.MAX_DISTANCE+a+"px");break;case "rtol":1==this.slideSide?d.css("left",-1*this.MAX_DISTANCE+a+"px"):d.css("left",a+"px");break;case "ttob":1==this.slideSide?d.css("top",a+"px"):d.css("top",this.MAX_DISTANCE+a+"px");break;case "btot":1==this.slideSide?d.css("top",-1*this.MAX_DISTANCE+a+"px"):d.css("top",a+"px")}};l.prototype.action=function(a){var b=
this,c=function(){var f=0>a-b.currentRatio?-1:1,e=b.currentRatio,e=0>f?Math.max(a,b.currentRatio+0.09*f):Math.min(a,b.currentRatio+0.09*f);b.step(e);e!=a?setTimeout(c,20):b.cleanup()};this.isInAnimation=!0;c()};l.prototype.cleanup=function(){var a=c(this.element).children(".working");c(".sliding").replaceWith("");c(".slidingBg").replaceWith("");c(".slideShadow").replaceWith("");var b=this.slideSide,d=a;"ltor"==this.options.forwardDir&&1==b||"rtol"==this.options.forwardDir&&-1==b||"ttob"==this.options.forwardDir&&
1==b||"btot"==this.options.forwardDir&&-1==b?1==Math.abs(this.currentRatio)&&(d=this.getNextContent(a)):1==Math.abs(this.currentRatio)&&(d=this.getPrevContent(a));d.addClass("flipCurrent");a.removeClass("working");"function"==typeof this.options.didEndFlip&&this.options.didEndFlip();this.slideSide=this.currentRatio=null;this.isInAnimation=!1};l.prototype.getNextContent=function(a){a=a.next(".flipContent");0==a.length&&this.options.loop&&(a=c(this.element).children(".flipContent").first());return 0==
a.length?c():a};l.prototype.getPrevContent=function(a){a=a.prev(".flipContent");0==a.length&&this.options.loop&&(a=c(this.element).children(".flipContent").last());return 0==a.length?c():a};l.prototype.shouldTransitionContinue=function(a){return Math.abs(a)>this.THREASHOLD_RATIO};h.prototype.jqmInit=function(){if(null!=c.mobile){var a=c(this.element);c.mobile.ns&&(r=c.mobile.ns);for(var b=0,d=s.length;b<d;b++){var f=s[b],e=a.attr("data-"+r+f.attr);e&&(this.options[f.key]=1==f.type?"true"==e.toLowerCase()?
!0:!1:e)}}};h.prototype.isFlipSupported=function(){var a=c.browser;return a.webkit||a.mozilla&&10<parseInt(a.version.slice(0,2))?!0:!1};h.prototype._getMouseMovement=function(a,b){if(null==this._clickContext.downPt)return null;var c=a-this._clickContext.downPt.x,f=b-this._clickContext.downPt.y,c="rtol"==this.options.forwardDir||"ltor"==this.options.forwardDir?c:f;if(null==this._clickContext.flipside)if(Math.abs(c)>this.effect.START_OFFSET)this._clickContext.flipside=0>c?-1:1,this.effect.init(this._clickContext.flipside);
else return null;return c-=this.effect.START_OFFSET*(-1==this._clickContext.flipside?-1:1)};h.prototype._getClientMousePos=function(a){return null==a.clientX&&a.originalEvent?{x:a.originalEvent.clientX,y:a.originalEvent.clientY}:{x:a.clientX,y:a.clientY}};h.prototype.vmousedown=function(a){if(this._clickContext.downPt||this.effect.isInAnimation)return!1;var a=this._getClientMousePos(a),b=(new Date).getTime();this._clickContext.downPt=a;this._clickContext.downTime=b;this._clickContext.lastInfo={x:a.x,
y:a.y,time:b};this._clickContext.dList=[];this._clickContext.tList=[];return!0};h.prototype._getRatio=function(a){a/=this.effect.MAX_DISTANCE;return a=1==this._clickContext.flipside?Math.min(Math.max(0,a),1):Math.min(Math.max(-1,a),0)};h.prototype._pushMouseInfo=function(a){var b=(new Date).getTime(),c=0,c="ltor"==this.options.forwardDir||"rtol"==this.options.forwardDir?a.x-this._clickContext.lastInfo.x:a.y-this._clickContext.lastInfo.y;if(0==c)return!1;var f=b-this._clickContext.lastInfo.time;20<
this._clickContext.dList.length&&(this._clickContext.dList.shift(),this._clickContext.tList.shift());this._clickContext.dList.push(c);this._clickContext.tList.push(f);this._clickContext.lastInfo={x:a.x,y:a.y,time:b};return!0};h.prototype.vmousemove=function(a){if(null==this._clickContext.downPt||this.effect.isInAnimation)return!1;var b=this._getClientMousePos(a),c=this._getMouseMovement(b.x,b.y);if(null==c||!this._pushMouseInfo(b))return!1;this.effect.step(this._getRatio(c));a.preventDefault();return!1};
h.prototype.flipPrev=function(){if(null==this._clickContext.flipside){var a=this.options.forwardDir;0<this.effect.getPrevContent(c(this.element).children(".flipCurrent")).length&&("rtol"==a||"btot"==a?(this._clickContext.flipside=1,this.effect.init(this._clickContext.flipside),this.effect.action(1)):(this._clickContext.flipside=-1,this.effect.init(this._clickContext.flipside),this.effect.action(-1)))}};h.prototype.flipNext=function(){if(null==this._clickContext.flipside){var a=this.options.forwardDir;
0<this.effect.getNextContent(c(this.element).children(".flipCurrent")).length&&("rtol"==a||"btot"==a?(this._clickContext.flipside=-1,this.effect.init(this._clickContext.flipside),this.effect.action(-1)):(this._clickContext.flipside=1,this.effect.init(this._clickContext.flipside),this.effect.action(1)))}};h.prototype._getCleanupFunc=function(){var a=this;return function(){if(a.options.showPager){var b=c(a.element).children(".flipCurrent").index();a.setPagerPos(b)}a._clickContext.downPt=null;a._clickContext.downTime=
null;a._clickContext.flipside=null;a._clickContext.lastInfo=null;a._clickContext.dList=[];a._clickContext.aList=[]}};h.prototype.vmouseup=function(a){if(null==this._clickContext.downPt||this.effect.isInAnimation)return!0;var b=this._getClientMousePos(a),d=c(this.element),b=this._getMouseMovement(b.x,b.y);if(null==b)return this._clickContext.downPt=null,this._clickContext.flipside=null,this._clickContext.downTime=null,this._clickContext.lastInfo=null,this._clickContext.dList=[],this._clickContext.aList=
[],!0;var b=this._getRatio(b),f=-1==this._clickContext.flipside?-1:1,d=d.children(".working"),e=null,e=0,e=this.options.forwardDir,g=this._clickContext.flipside,e="ltor"==e&&1==g||"rtol"==e&&-1==g||"ttob"==e&&1==g||"btot"==e&&-1==g?this.effect.getNextContent(d):this.effect.getPrevContent(d),e=this.effect.shouldTransitionContinue(b,this._clickContext)&&0<e.length?f:0;this.effect.action(e);a.preventDefault();return!0};h.prototype.initPager=function(){var a=c(this.element),b=a.height()-24+"px";a.children("div,p,section,article").each(function(a,
d){c(d).css("height",b)});var d=a.children(".flipContent").length;a.append(c('<div class="pager"></div>'));$pager=a.children(".pager");for(var f=0;f<d;f++)$pager.append(c('<span class="dot">&nbsp;</span>'));a=a.children(".flipCurrent").index();$currentA=$pager.children(".dot");$currentA.eq(a).addClass("current")};h.prototype.setPagerPos=function(a){var b=c(this.element);b.find(".pager span.dot.current").removeClass("current");b.find(".pager span.dot").eq(a).addClass("current")};h.prototype.pagerTap=
function(a){var b=c(this.element).children(".pager").width();this._getClientMousePos(a).x<b/2?this.flipPrev():this.flipNext()};h.prototype._isAccessFromMobileBrowser=function(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/)?!0:!1};h.prototype.init=function(){ua=c.browser;ua.webkit?p="webkit":ua.mozilla&&10<parseInt(ua.version.slice(0,2))&&(p="Moz");
var a=c(this.element),b=this.options.height;if(""==b){var d=a.parent().height();0==d&&(d=c(o.body).height());b=d-a.offset().top+"px"}a.addClass("flipContainer").css("height",b);a.children("div,p,section").each(function(a,d){c(d).addClass("flipContent").css("height",b)});0==a.children(".flipCurrent").length&&a.children().eq(0).addClass("flipCurrent");var f="mousedown",d="mousemove",e="mouseup";c.mobile&&(f="vmousedown",d="vmousemove",e="vmouseup");var g=this;this._isAccessFromMobileBrowser()||(g=this,
a.find("img").each(function(a,b){c(b).bind(f,function(a){a.preventDefault()})}));this.options.showPager&&(this.initPager(),a=a.children(".pager"),a.bind(f,function(a){a.preventDefault();return false}),a.bind(e,function(a){g.pagerTap(a);a.preventDefault();return false}));c(this.element).bind(f,function(a){return g.vmousedown(a)});c(this.element).bind(d,function(a){return g.vmousemove(a)});c(this.element).bind(e,function(a){return g.vmouseup(a)});this.options.keyboardNav&&(g=this,c(o).unbind("keydown.flip").bind("keydown.flip",
function(a){if(!c(a.target).is("input, textarea, select, button")){var b=g.options.forwardDir;a.keyCode===37?b=="rtol"?g.flipNext():g.flipPrev():a.keyCode===39&&(b=="rtol"?g.flipPrev():g.flipNext())}}))};c.fn[n]=function(a){1<this.length&&(a.keyboardNav=!1);return this.each(function(){if(!c.data(this,"plugin_"+n)){var b=new h(this,a);c.data(this,"plugin_"+n,b)}})};c(o).bind("pageinit create",function(a){c(':jqmData(role="flip")',a.target).flip()})})(jQuery,window,document);
